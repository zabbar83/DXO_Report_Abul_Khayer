select  
        t1.name name,
        t1.designation designation,
        t1.division_id divisionId,
        t1.divisionName divisionName,
        NVL(t1.crossCheckTar,0) crossCheckTar,
        NVL(t2.total_cross_check,0) acheivement,
        NVL(t2.yes,0)yes,
        NVL(t2.no,0)no,
        NVL(t2.yesCount,0) yesCount,
        NVL(t2.noCount,0) noCount,
        NVL(t2.correction,0)correction,
        NVL(t1.onTheJobTar,0)onTheJobTar,
        NVL(t3.activity,0)activity,
        NVL(t1.crossCheckTarSur,0)crossCheckTarSur,
        NVL(t4.total_cross_check_sur,0)acheivementSur,
        NVL(t4.yes,0)yesSur,
        NVL(t4.no,0)noSur,
        NVL(t4.yesCount,0) yesCountSur,
        NVL(t4.noCount,0) noCountSur
from
        (
                select   
                        ei.emp_name name,
                        r.role designation,
                        v.division_id,
                        v.division_name divisionName,
                        10 crossCheckTar,
                        5 onTheJobTar,
                        2 crossCheckTarSur
                from    (select distinct division_id,division_name from v_teritory_all
                         where 1=1 and (:divisionId is null or division_id=:divisionId)) v
                join    users u on v.division_id=u.teritory_id
                left join    emp_info ei on u.user_id=ei.users_id
                join    users_roles ur on u.user_id=ur.users_user_id
                join    role r on ur.roles_id=r.id
                and     r.id=6
        )t1
LEFT    JOIN 
                (select  
                        checked_by,
                        division_id,
                        role_id,
                        count(outlet_id) total_cross_check,
                        sum(case when yes=9 then 1 else 0 end)yes,
                        sum(case when no <> 9 and no <> 0 then 1 else 0 end)no,
                        sum(yes) yesCount,
                        sum(no) noCount,
                        sum(b.ans_count) correction
                from    (select     checked_by,
                                    division_id,
                                    role_id,
                                    outlet_id,
                                    count(case when ans='yes' then 1 else null end) yes,
                                    count(case when ans='no' then 1 else null end) no
                            from 
                                        (select  
                                                        checked_by,
                                                        u.teritory_id division_id,
                                                        role_id,
                                                        outlet_id,
                                                        case when option_id = 1 then 'yes' else 'no' end ans
                                                from    CC_OUT_ANSWERS coa
                                                join    users u on coa.checked_by=u.user_id
                                                where   coa.cross_check_date= :targetDate
                                                and     (:divisionId is null or u.teritory_id=:divisionId)
                                                and     role_id=6
                                        )
                            group   by checked_by,division_id,role_id,outlet_id
                                    )a
                                    left join (select  consumer_id,count(distinct question_id) ans_count
                                                    from    CC_OUT_ACT_FIRST_UP_ANS coaf
                                                    where   coaf.cross_check_date= :targetDate
                                                    and     coaf.role_id=6
                                                    group   by consumer_id
                                                )b on a.outlet_id=b.consumer_id
                group   by checked_by,division_id,role_id
        )t2 ON t1.division_id=t2.division_id
LEFT    JOIN 
                (select  
                        ddxo_id,
                        u.teritory_id division_id,
                        count(con_out_id) activity
                from    (select  add_date,ddxo_id,cons_act_id con_out_id
                            from    CONS_ON_THE_JOB_TRAIN
                            union   all
                            select  add_date,ddxo_id,outlet_id con_out_id
                            from    OUT_ON_THE_JOB_TRAIN
                         ) cj
                join    users u on cj.ddxo_id=u.user_id
                where   add_date= :targetDate
                and     (:divisionId is null or u.teritory_id=:divisionId)
                group   by ddxo_id,u.teritory_id
                )t3 ON t1.division_id=t3.division_id
LEFT    JOIN 
                (select  
                        checked_by,
                        division_id,
                        role_by,
                        count(br_activity_consumer_id) total_cross_check_sur,
                        sum(case when yes=9 then 1 else 0 end)yes,
                        sum(case when no <> 9 and no <> 0 then 1 else 0 end)no,
                        sum(yes) yesCount,
                        sum(no) noCount
                from    (select     checked_by,
                                    division_id,
                                    role_by,
                                    br_activity_consumer_id,
                                    count(case when ans='yes' then 1 else null end) yes,
                                    count(case when ans='no' then 1 else null end) no
                            from 
                                        (select  
                                                        checked_by,
                                                        u.teritory_id division_id,
                                                        role_by,
                                                        br_activity_consumer_id,
                                                        case when option_id = 1 then 'yes' else 'no' end ans
                                                from    CC_CONS_FIRST_ANSWERS cfa
                                                join    users u on cfa.checked_by=u.user_id
                                                where   cfa.cross_check_date=:targetDate
                                                and     (:divisionId is null or u.teritory_id=:divisionId)
                                                and     role_by=6
                                        )
                            group   by checked_by,division_id,role_by,br_activity_consumer_id
                                    )
                group   by checked_by,division_id,role_by
        )t4 ON t1.division_id=t4.division_id
Order   by t1.division_id